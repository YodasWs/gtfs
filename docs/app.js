"use strict";(()=>{function e(){[...document.querySelectorAll(".no-google")].forEach(e=>{e.removeAttribute("hidden")}),[...document.querySelectorAll("#google-maps")].forEach(e=>{e.setAttribute("hidden","hidden")})}function t(){[...document.querySelectorAll(".no-workers")].forEach(e=>{e.removeAttribute("hidden")})}window.json={};const o={opacity:{rail:1,tram:1,bus:1,etc:1},weight:{rail:e=>e>=14?e-12:e>=12?2:e>=10?1:0,bus:e=>e>=16?e-14:e>=14?e-13:0,etc:()=>0}},i={107:{x_route_icon:"1f688",minZoom:12,zIndex:95,icon:{url:"pins/icons8-tram-32.png",scaledSize:{width:22,height:22},anchor:{x:11,y:11}}},108:{x_route_icon:"1f688",minZoom:12,zIndex:95,icon:{url:"pins/icons8-tram-32.png",scaledSize:{width:22,height:22},anchor:{x:11,y:11}}},208:{minZoom:15,zIndex:80,x_route_icon:"1f4ba",icon:{url:"pins/icons8-bus-32.png",scaledSize:{width:22,height:22},anchor:{x:11,y:11}}},401:{x_route_icon:"1f687",minZoom:13,zIndex:95,icon:{url:"pins/icons8-subway-32.png",scaledSize:{width:22,height:22},anchor:{x:11,y:11}}},702:{minZoom:15,zIndex:90,x_route_icon:"1f68d",icon:{url:"pins/icons8-bus-32.png",scaledSize:{width:22,height:22},anchor:{x:11,y:11}}},704:{x_route_icon:"1f68c",minZoom:15,zIndex:0,icon:{url:"pins/icons8-bus-32.png",scaledSize:{width:22,height:22},anchor:{x:11,y:11}}},901:{minZoom:13,zIndex:90,x_route_icon:"1f688",icon:{url:"pins/icons8-tram-32.png",scaledSize:{width:22,height:22},anchor:{x:11,y:11}}},902:{minZoom:14,zIndex:90,x_route_icon:"1f68b",icon:{url:"pins/icons8-tram-32.png",scaledSize:{width:22,height:22},anchor:{x:11,y:11}}},1200:{minZoom:11,zIndex:100,x_route_icon:"26f4",icon:{url:"pins/icons8-water-transportation-32.png",scaledSize:{width:22,height:22},anchor:{x:11,y:11}}},1300:{minZoom:13,zIndex:90,x_route_icon:"1f6a0",icon:{url:"pins/icons8-funicular-32.png",scaledSize:{width:22,height:22},anchor:{x:11,y:11}}},1400:{minZoom:14,zIndex:90,x_route_icon:"1f69e",icon:{url:"pins/icons8-funicular-32.png",scaledSize:{width:22,height:22},anchor:{x:11,y:11}}},tram:{minZoom:14,zIndex:90,icon:{url:"pins/icons8-tram-32.png",scaledSize:{width:22,height:22},anchor:{x:11,y:11}}},metro:{minZoom:14,zIndex:95,icon:{url:"pins/icons8-subway-32.png",scaledSize:{width:22,height:22},anchor:{x:11,y:11}}},rail:{minZoom:12,zIndex:100,icon:{url:"pins/icons8-tram-32.png",scaledSize:{width:22,height:22},anchor:{x:11,y:11}}},bus:{minZoom:15,zIndex:0,icon:{url:"pins/icons8-bus-32.png",scaledSize:{width:22,height:22},anchor:{x:11,y:11}}}};i[0]=i[901],i[1]=i[401],i[3]=i[704],i[4]=i[1200],i[6]=i[1300],i[7]=i[1400];class s extends Worker{constructor(){super(...arguments),this.extremes={north:-90,south:90,east:-180,west:180},this.eventAborts=new AbortController,this.polylines={},this.shapes={},this.stops={}}getStopOptionsForRouteType(e){const t=Number.parseInt(e);return{...(()=>{if("object"==typeof i[e]&&null!==i[e])return i[e];if(Number.isFinite(t))switch(Math.floor(t/100)){case 1:return i.rail;case 7:return i.bus;case 9:return i.tram}switch(e){case"0":case"4":case"5":case"6":case"7":return i.tram;case"1":case"12":return i.metro;case"2":return i.rail;case"3":case"11":return i.bus}return i.bus})(),minZoom:this.getMinZoomForRouteType(e)}}getPinForType(e){}getMinZoomForRouteType(e){if("object"==typeof i[e]&&null!==i[e]&&Number.isFinite(i[e].minZoom))return i[e].minZoom;const t=Number.parseInt(e);if(Number.isFinite(t)){switch(t){case 107:return i.rail.minZoom+1;case 108:return i.bus.minZoom}switch(Math.floor(t/100)){case 1:return i.rail.minZoom;case 4:return i.metro.minZoom;case 7:case 8:return i.bus.minZoom;case 9:return i.tram.minZoom}}return 16}listAgencies(e){if(!Array.isArray(e))return;const t=document.querySelector("main");if(!(t instanceof Element))return;let o=document.querySelector("section.agency");o instanceof Element||(o=document.createElement("section"),o.classList.add("agency")),e.forEach(e=>{"object"==typeof e&&null!==e&&e.agency_id&&(o.insertAdjacentHTML("beforeend",`<h1>${e.agency_name}`),e.agency_url&&o.insertAdjacentHTML("beforeend",`<a href="${e.agency_url}" target="_blank">Agency Website`))}),t.appendChild(o)}listRoutes(e){if(!Array.isArray(e))return;const t=document.querySelector("main");t instanceof Element&&(e.forEach(e=>{let o=document.querySelector(`section[data-route-id="${e.route_id}"]`);if(o instanceof Element&&o.querySelector("h1")instanceof Element)return;o=document.createElement("section"),o.setAttribute("data-route-id",e.route_id),o.setAttribute("data-route-type",e.route_type),o.setAttribute("data-route-short-name",e.route_short_name),t.appendChild(o);const s=i[e.route_type]&&i[e.route_type].x_route_icon||e.x_route_icon;e.route_short_name?(o.insertAdjacentHTML("beforeend",`<h1 style="background:#${e.route_color||"ffffff"};color:#${e.route_text_color||"000000"}">&#x${s};&#xfe0f; ${e.route_short_name}`),o.insertAdjacentHTML("beforeend",`<h2 style="background:#${e.route_color||"ffffff"};color:#${e.route_text_color||"000000"}">&#x${s};&#xfe0e; ${e.route_long_name}`)):o.insertAdjacentHTML("beforeend",`<h1 style="background:#${e.route_color||"ffffff"};color:#${e.route_text_color||"000000"}">&#x${s};&#xfe0f; ${e.route_long_name} &#x${s};&#xfe0e;`),"string"==typeof e.route_desc&&""!==e.route_desc&&o.insertAdjacentHTML("beforeend",`<div>${e.route_desc}`)}),this.eventAborts.abort(),this.eventAborts=new AbortController,[...document.querySelectorAll("section[data-route-id] > h1, section[data-route-id] > h2")].forEach(e=>{e.addEventListener("click",this.activateRoute.bind(this),{signal:this.eventAborts.signal})}),[...document.querySelectorAll("section[data-route-id]")].sort((e,t)=>{const o=e.getAttribute("data-route-type"),i=t.getAttribute("data-route-type");if(o!==i){const e=Number.parseInt(o),t=Number.parseInt(i);if(Number.isFinite(e)&&Number.isFinite(t)&&e!==t){const o=3===e||7===Math.floor(e/100),i=3===t||7===Math.floor(t/100);if(o&&i)return e-t;if(o!==i){if(o)return 1;if(i)return-1}if(Math.floor(e/100)!==Math.floor(t/100)){if(8==Math.floor(e/100))return 1;if(8==Math.floor(t/100))return-1;if(2==Math.floor(e/100))return 1;if(2==Math.floor(t/100))return-1}return e-t}}const s=e.getAttribute("data-route-short-name"),n=t.getAttribute("data-route-short-name");if(s&&n){const e=Number.parseInt(s),t=Number.parseInt(n);return Number.isFinite(e)&&Number.isFinite(t)&&e!==t?e-t:s.localeCompare(n)}return 0}).forEach(e=>{t.appendChild(e)}))}activateRoute(e){const t=e.target.closest("section[data-route-id]");if(!(t instanceof Element))return;const o=t.classList.contains("highlighted");if([...document.querySelectorAll("section[data-route-id].highlighted")].forEach(e=>{const t=e.getAttribute("data-route-id");"object"==typeof this.stops[t]&&null!==this.stops[t]&&Object.entries(this.stops[t]).forEach(_ref=>{let[e,t]=_ref;t.highlighted=!1,t.setVisible(!1)}),e.classList.remove("highlighted");const o=e.querySelector("ol");o instanceof Element&&(o.style.maxHeight="0")}),!o){t.classList.add("highlighted");const e=t.querySelector("ol");e instanceof Element&&(e.style.maxHeight=`${e.getAttribute("data-max-height")}px`)}const i=t.getAttribute("data-route-id");Object.entries(this.shapes).forEach(_ref2=>{let[e,t]=_ref2;t.highlighted=!1,t.routes.has(i)&&(o||(t.highlighted=!0,this.polylines[t.shape_id].setOptions({strokeOpacity:.9,strokeWeight:9,zIndex:100})))}),o||"object"!=typeof this.stops[i]||null===this.stops[i]||Object.entries(this.stops[i]).forEach(_ref3=>{let[e,t]=_ref3;t.setOptions(this.getStopOptionsForRouteType(t.route_type)),t.highlighted=!0,t.setVisible(!0)}),this.zoomChangePolylines(),o||(t.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>{t.scrollIntoView({behavior:"smooth",block:"start"})},1e3))}zoomChangePolylines(){let e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;(()=>{if("object"!=typeof this.polylines||null===this.polylines)return;const t=new Map([[1,"rail"],[9,"rail"],[7,"bus"]]);let i=1;this.map.zoom>=14&&(i=1.5),Object.entries("object"==typeof e&&null!==e?{[e.shape_id]:e}:this.shapes).forEach(_ref4=>{let[e,s]=_ref4;if(!s.highlighted&&this.polylines[s.shape_id]instanceof google.maps.Polyline){let e="etc";if(Number.parseInt(s.route_type)>=100){const o=Math.floor(Number.parseInt(s.route_type)/100);t.has(o)&&(e=t.get(o))}else"0"===s.route_type||"2"===s.route_type?e="rail":"3"===s.route_type&&(e="bus");this.polylines[s.shape_id].setOptions({strokeOpacity:s.opacity*i,strokeWeight:s.weight+o.weight[e](this.map.zoom)})}})})(),(()=>{"object"==typeof this.stops&&null!==this.stops&&Object.entries(this.stops).forEach(_ref5=>{let[e,t]=_ref5;Object.entries(t).forEach(_ref6=>{let[e,t]=_ref6;this.map.zoom>=this.getMinZoomForRouteType(t.route_type)?t.setVisible(!0):t.highlighted||t.setVisible(!1)})})})()}drawPolylines(e){google&&this.map&&Object.values(e).forEach(this.drawPolyline.bind(this))}drawPolyline(e){if("object"!=typeof google||"object"!=typeof this.map||!Array.isArray(e.path)||e.path.length<=1)return;this.shapes[e.shape_id]=e,this.polylines[e.shape_id]instanceof google.maps.Polyline||(this.polylines[e.shape_id]=new google.maps.Polyline({geodesic:!0,opacity:.6,clickable:!0,map:this.map}));const t=(e=>{switch(Math.floor(Number.parseInt(e)/100)){case 1:return 10;case 7:return 0}switch(e){case"0":return 8;case"1":case"12":return 9;case"2":return 10;case"3":return 0;case"1200":case"4":case"1400":case"7":return 7;case"1300":case"6":return 6}return 1})(e.route_type);this.polylines[e.shape_id].setOptions({strokeColor:`#${e.route_color||"008800"}`,zIndex:t,path:e.path}),this.zoomChangePolylines(e)}listStops(e){e.forEach((e,t)=>{let o=document.querySelector(`section[data-route-id="${t}"]`);o instanceof Element?e.forEach((e,i)=>{if(!Array.isArray(e)||0===e.length)return;[...o.querySelectorAll("ol")].forEach(e=>e.remove()),"object"==typeof this.stops[t]&&null!==this.stops[t]||(this.stops[t]={});const s=document.createElement("ol"),n=o.getAttribute("data-route-type");e.forEach(e=>{const o=document.createElement("li");let i=e.stop_name;"string"==typeof e.stop_code&&""!==e.stop_code?(i=`${e.stop_code}. ${e.stop_name}`,Number.isFinite(Number.parseInt(e.stop_code)),o.innerHTML=`${e.stop_name} (${e.stop_code})`):o.innerHTML=e.stop_name,s.appendChild(o),this.stops[t][e.stop_id]instanceof google.maps.Marker||(this.stops[t][e.stop_id]=new google.maps.Marker({...this.getStopOptionsForRouteType(n),position:{lat:Number.parseFloat(e.stop_lat),lng:Number.parseFloat(e.stop_lon)},visible:!1,map:this.map,title:i})),this.stops[t][e.stop_id].route_type=n}),o.appendChild(s),s.setAttribute("data-max-height",s.offsetHeight)}):console.error("Sam, route",t,"not set?!")})}}yodasws.page("home").setRoute({template:"pages/home.html",route:"/([a-z]{2}/([\\w-]+/)?)?"}).on("load",()=>{if(!window.Worker)return void t();const o=new s("res/gtfs.js");if(!(o instanceof Worker))return void t();o.onmessage=e=>{const[t,...i]=e.data;"function"==typeof o[t]&&o[t](...i)};const i=(()=>{const e=window.location.hash.replace(/^#!\/|\/$/g,"");let t={"jp/hakone":{search:"Hakone, Japan",title:"Hakone, Japan",files:["jp/hakone"]},"us/charlotte":{search:"Charlotte, NC, USA",title:"Charlotte",files:["us/charlotte"]},"us/new-york":{search:"New York City",title:"New York City",files:["us/nyc-bx-bus","us/nyc-si-bus","us/nyc-subway","us/nyc-b-bus","us/nyc-m-bus","us/nyc-q-bus","us/nyc-lirr","us/nyc-path"]}};return t[e]?t[e]:(t=Object.entries(t).filter(_ref7=>{let[t,o]=_ref7;return t.includes(e)}),t[Math.floor(Math.random()*t.length)][1])})();if(!i)return void e();const n="yodasws.github.io"===window.location.hostname?"gtfs/":"";i.files.forEach(e=>{o.postMessage(["loadGTFS",`${n}${e}`])}),(()=>{[...document.querySelectorAll("#google-maps, .gtfs")].forEach(e=>{e.removeAttribute("hidden")}),yodasws.setPageTitle(i.title);const e=document.querySelector("main > h2");e instanceof Element&&(e.innerHTML=i.title)})(),"object"==typeof google&&null!==google&&"object"==typeof google.maps&&null!==google.maps&&document.getElementById("google-maps")instanceof Element?new google.maps.Geocoder().geocode({address:i.search},(t,i)=>{if("OK"!==i)return e(),void console.error("Sam, Geocoder failed,",i);o.map=new google.maps.Map(document.getElementById("google-maps"),{mapTypeId:google.maps.MapTypeId.ROADMAP,gestureHandling:"cooperative",keyboardShortcuts:!0,disableDefaultUI:!0,scaleControl:!0,scrollWheel:!0,zoomControl:!0,maxZoom:18,minZoom:9,zoom:11,center:t[0].geometry.location}),o.map.zoom=o.map.getZoom(),o.map.addListener("zoom_changed",e=>{o.zoomChangePolylines()})}):e()}),yodasws.on("page-loaded",()=>{"undefined"!=typeof $&&$&&$("main").on("click","li[data-stop-id]",e=>{var t=$(e.target).closest("li[data-stop-id]"),o=t.data("stop-id"),i=(t.parents("section[data-route-id]").data("route-id"),gtfs.stops[o].Marker.getVisible());!$(e.target).closest("section[data-route-id]").is(".active")&&t.is(".active")||(gtfs.hideStops(),$("li[data-stop-id].active").removeClass("active"),$("section[data-route-id].highlighted").removeClass("highlighted"),i||($("li[data-stop-id=\""+o+"\"]").addClass("active").parents("section[data-route-id]").addClass("highlighted"),gtfs.stops[o].Marker.setVisible(!0),gtfs.map.panTo(gtfs.stops[o].Marker.getPosition())))})})})();