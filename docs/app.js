"use strict";(()=>{function e(){[...document.querySelectorAll(".no-google")].forEach(e=>{e.removeAttribute("hidden")}),[...document.querySelectorAll("#google-maps")].forEach(e=>{e.setAttribute("hidden","hidden")})}function t(){[...document.querySelectorAll(".no-workers")].forEach(e=>{e.removeAttribute("hidden")})}window.json={};const o={tram:{minZoom:10,zIndex:90,icon:{url:"pins/icons8-tram-32.png",scaledSize:{width:22,height:22},anchor:{x:11,y:11}}},metro:{minZoom:14,zIndex:95,icon:{url:"pins/icons8-tram-32.png",scaledSize:{width:22,height:22},anchor:{x:11,y:11}}},rail:{minZoom:12,zIndex:100,icon:{url:"pins/icons8-tram-32.png",scaledSize:{width:22,height:22},anchor:{x:11,y:11}}},bus:{minZoom:15,zIndex:0,icon:{url:"pins/icons8-bus-32.png",scaledSize:{width:22,height:22},anchor:{x:11,y:11}}}};class s extends Worker{constructor(){super(...arguments),this.extremes={north:-90,south:90,east:-180,west:180},this.eventAborts=new AbortController,this.polylines={},this.shapes={},this.stops={}}getStopOptionsForRouteType(e){const t=Number.parseInt(e);return{...(()=>{if("object"==typeof o[e]&&null!==o[e]&&Number.isFinite(o[e]))return o[e];if(Number.isFinite(t))switch(Math.floor(t/100)){case 1:return o.rail;case 7:return o.bus;case 9:return o.tram}switch(e){case"0":case"4":case"5":case"6":case"7":return o.tram;case"1":case"12":return o.metro;case"2":return o.rail;case"3":case"11":return o.bus}return o.bus})(),minZoom:this.getMinZoomForRouteType(e)}}getPinForType(e){}getMinZoomForRouteType(e){if("object"==typeof o[e]&&null!==o[e]&&Number.isFinite(o[e].minZoom))return o[e].minZoom;const t=Number.parseInt(e);if(Number.isFinite(t)){switch(t){case 107:return o.rail.minZoom+1;case 107:return o.bus.minZoom}switch(Math.floor(t/100)){case 1:return o.rail.minZoom;case 4:return o.metro.minZoom;case 7:case 8:return o.bus.minZoom;case 9:return o.tram.minZoom}}return 16}listAgencies(e){if(!Array.isArray(e))return;const t=document.querySelector("main");if(!(t instanceof Element))return;let o=document.querySelector("section.agency");o instanceof Element||(o=document.createElement("section"),o.classList.add("agency")),e.forEach(e=>{"object"==typeof e&&null!==e&&e.agency_id&&(o.insertAdjacentHTML("beforeend",`<h1>${e.agency_name}`),e.agency_url&&o.insertAdjacentHTML("beforeend",`<a href="${e.agency_url}" target="_blank">Agency Website`))}),t.appendChild(o)}listRoutes(e){if(!Array.isArray(e))return;const t=document.querySelector("main");t instanceof Element&&(e.forEach(e=>{let o=document.querySelector(`section[data-route-id="${e.route_id}"]`);o instanceof Element&&o.querySelector("h1")instanceof Element||(o=document.createElement("section"),o.setAttribute("data-route-id",e.route_id),o.setAttribute("data-route-type",e.route_type),o.setAttribute("data-route-short-name",e.route_short_name),t.appendChild(o),e.route_short_name?(o.insertAdjacentHTML("beforeend",`<h1 style="background:#${e.route_color||"ffffff"};color:#${e.route_text_color||"000000"}">&#x${e.x_route_icon};&#xfe0f; ${e.route_short_name}`),o.insertAdjacentHTML("beforeend",`<h2 style="background:#${e.route_color||"ffffff"};color:#${e.route_text_color||"000000"}">&#x${e.x_route_icon};&#xfe0e; ${e.route_long_name}`)):o.insertAdjacentHTML("beforeend",`<h1 style="background:#${e.route_color||"ffffff"};color:#${e.route_text_color||"000000"}">&#x${e.x_route_icon};&#xfe0f; ${e.route_long_name} &#x${e.x_route_icon};&#xfe0e;`),"string"==typeof e.route_desc&&""!==e.route_desc&&o.insertAdjacentHTML("beforeend",`<div>${e.route_desc}`))}),this.eventAborts.abort(),this.eventAborts=new AbortController,[...document.querySelectorAll("section[data-route-id] > h1, section[data-route-id] > h2")].forEach(e=>{e.addEventListener("click",this.activateRoute.bind(this),{signal:this.eventAborts.signal})}),[...document.querySelectorAll("section[data-route-id]")].sort((e,t)=>{const o=e.getAttribute("data-route-type"),s=t.getAttribute("data-route-type");if(o!==s){const e=Number.parseInt(o),t=Number.parseInt(s);if(Number.isFinite(e)&&Number.isFinite(t)&&e!==t){const o=3===e||7===Math.floor(e/100),s=3===t||7===Math.floor(t/100);if(o&&s)return e-t;if(o!==s){if(o)return 1;if(s)return-1}if(Math.floor(e/100)!==Math.floor(t/100)){if(8==Math.floor(e/100))return 1;if(8==Math.floor(t/100))return-1;if(2==Math.floor(e/100))return 1;if(2==Math.floor(t/100))return-1}return e-t}}const r=e.getAttribute("data-route-short-name"),i=t.getAttribute("data-route-short-name");if(r&&i){const e=Number.parseInt(r),t=Number.parseInt(i);return Number.isFinite(e)&&Number.isFinite(t)&&e!==t?e-t:r.localeCompare(i)}return 0}).forEach(e=>{t.appendChild(e)}))}activateRoute(e){const t=e.target.closest("section[data-route-id]");if(!(t instanceof Element))return;const o=t.classList.contains("highlighted");if([...document.querySelectorAll("section[data-route-id].highlighted")].forEach(e=>{const t=e.getAttribute("data-route-id");"object"==typeof this.stops[t]&&null!==this.stops[t]&&Object.entries(this.stops[t]).forEach(_ref=>{let[e,t]=_ref;t.highlighted=!1,t.setVisible(!1)}),e.classList.remove("highlighted");const o=e.querySelector("ol");o instanceof Element&&(o.style.maxHeight="0")}),!o){t.classList.add("highlighted");const e=t.querySelector("ol");e instanceof Element&&(e.style.maxHeight=`${e.getAttribute("data-max-height")}px`)}const s=t.getAttribute("data-route-id");Object.entries(this.shapes).forEach(_ref2=>{let[e,t]=_ref2;t.highlighted=!1,t.routes.has(s)&&(o||(t.highlighted=!0,this.polylines[t.shape_id].setOptions({strokeOpacity:.9,strokeWeight:9,zIndex:100})))}),o||"object"!=typeof this.stops[s]||null===this.stops[s]||Object.entries(this.stops[s]).forEach(_ref3=>{let[e,t]=_ref3;t.setOptions(this.getStopOptionsForRouteType(t.route_type)),t.highlighted=!0,t.setVisible(!0)}),this.zoomChangePolylines(),o||(t.scrollIntoView({behavior:"smooth",block:"center"}),setTimeout(()=>{t.scrollIntoView({behavior:"smooth",block:"start"})},1e3))}zoomChangePolylines(){let e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;(()=>{if("object"!=typeof this.polylines||null===this.polylines)return;const t={opacity:{rail:1,bus:1,etc:1},weight:{rail:0,bus:0,etc:0}},o=new Map([[1,"rail"],[7,"bus"]]);let s=1;this.map.zoom>=10&&(t.weight.rail=1),this.map.zoom>=12&&(t.weight.rail=2),this.map.zoom>=14&&(s=1.5,t.weight.bus=this.map.zoom-13,t.weight.rail=this.map.zoom-12),this.map.zoom>=16&&(t.weight.bus=this.map.zoom-14),Object.entries("object"==typeof e&&null!==e?{[e.shape_id]:e}:this.shapes).forEach(_ref4=>{let[e,r]=_ref4;if(!r.highlighted&&this.polylines[r.shape_id]instanceof google.maps.Polyline){let e="etc";if(Number.parseInt(r.route_type)>=100){const t=Math.floor(Number.parseInt(r.route_type)/100);o.has(t)&&(e=o.get(t))}else"0"===r.route_type||"2"===r.route_type?e="rail":"3"===r.route_type&&(e="bus");this.polylines[r.shape_id].setOptions({strokeOpacity:r.opacity*s,strokeWeight:r.weight+t.weight[e]})}})})(),(()=>{"object"==typeof this.stops&&null!==this.stops&&Object.entries(this.stops).forEach(_ref5=>{let[e,t]=_ref5;Object.entries(t).forEach(_ref6=>{let[e,t]=_ref6;this.map.zoom>=this.getMinZoomForRouteType(t.route_type)?t.setVisible(!0):t.highlighted||t.setVisible(!1)})})})()}drawPolylines(e){google&&this.map&&Object.values(e).forEach(this.drawPolyline.bind(this))}drawPolyline(e){if("object"!=typeof google||"object"!=typeof this.map||!Array.isArray(e.path)||e.path.length<=1)return;this.shapes[e.shape_id]=e,this.polylines[e.shape_id]instanceof google.maps.Polyline||(this.polylines[e.shape_id]=new google.maps.Polyline({geodesic:!0,opacity:.6,clickable:!0,map:this.map}));const t=(e=>{switch(Math.floor(Number.parseInt(e)/100)){case 1:return 10;case 7:return 0}switch(e){case"0":return 8;case"1":case"12":return 9;case"2":return 10;case"3":return 0;case"1200":case"4":case"1400":case"7":return 7;case"1300":case"6":return 6}return 1})(e.route_type);this.polylines[e.shape_id].setOptions({strokeColor:`#${e.route_color||"008800"}`,zIndex:t,path:e.path}),this.zoomChangePolylines(e)}listStops(e){Object.entries(e).forEach(_ref7=>{let[e,t]=_ref7;let o=document.querySelector(`section[data-route-id="${e}"]`);if(!(o instanceof Element))return void console.error("Sam, route",e,"not set?!");if(!Array.isArray(t)||0===t.length)return;[...o.querySelectorAll("ol")].forEach(e=>e.remove()),"object"==typeof this.stops[e]&&null!==this.stops[e]||(this.stops[e]={});const s=document.createElement("ol"),r=o.getAttribute("data-route-type");t.forEach(t=>{const o=document.createElement("li");let i=t.stop_name;"string"==typeof t.stop_code&&""!==t.stop_code?(i=`${t.stop_code}. ${t.stop_name}`,Number.isFinite(Number.parseInt(t.stop_code)),o.innerHTML=`${t.stop_name} (${t.stop_code})`):o.innerHTML=t.stop_name,s.appendChild(o),this.stops[e][t.stop_id]instanceof google.maps.Marker||(this.stops[e][t.stop_id]=new google.maps.Marker({...this.getStopOptionsForRouteType(r),position:{lat:Number.parseFloat(t.stop_lat),lng:Number.parseFloat(t.stop_lon)},visible:!1,map:this.map,title:i})),this.stops[e][t.stop_id].route_type=r}),o.appendChild(s),s.setAttribute("data-max-height",s.offsetHeight)})}}yodasws.page("home").setRoute({template:"pages/home.html",route:"/([a-z]{2}/([\\w-]+/)?)?"}).on("load",()=>{if(!window.Worker)return void t();const o=new s("res/gtfs.js");if(!(o instanceof Worker))return void t();o.onmessage=e=>{const[t,...s]=e.data;"function"==typeof o[t]&&o[t](...s)};const r=(()=>{const e=window.location.hash.replace(/^#!\/|\/$/g,"");let t={"jp/hakone":{search:"Hakone, Japan",title:"Hakone, Japan",files:["jp/hakone"]},"us/charlotte":{search:"Charlotte, NC, USA",title:"Charlotte",files:["us/charlotte"]},"us/new-york":{search:"New York City",title:"New York City",files:["us/nyc-bx-bus","us/nyc-si-bus","us/nyc-subway","us/nyc-b-bus","us/nyc-m-bus","us/nyc-q-bus","us/nyc-lirr","us/nyc-path"]}};return t[e]?t[e]:(t=Object.entries(t).filter(_ref8=>{let[t,o]=_ref8;return t.includes(e)}),t[Math.floor(Math.random()*t.length)][1])})();if(!r)return void e();const i="yodasws.github.io"===window.location.hostname?"gtfs/":"";r.files.forEach(e=>{o.postMessage(["loadGTFS",`${i}${e}`])}),(()=>{[...document.querySelectorAll("#google-maps, .gtfs")].forEach(e=>{e.removeAttribute("hidden")}),yodasws.setPageTitle(r.title);const e=document.querySelector("main > h2");e instanceof Element&&(e.innerHTML=r.title)})(),"object"==typeof google&&null!==google&&"object"==typeof google.maps&&null!==google.maps&&document.getElementById("google-maps")instanceof Element?new google.maps.Geocoder().geocode({address:r.search},(t,s)=>{if("OK"!==s)return e(),void console.error("Sam, Geocoder failed,",s);o.map=new google.maps.Map(document.getElementById("google-maps"),{mapTypeId:google.maps.MapTypeId.ROADMAP,gestureHandling:"cooperative",keyboardShortcuts:!0,disableDefaultUI:!0,scaleControl:!0,scrollWheel:!0,zoomControl:!0,maxZoom:18,minZoom:9,zoom:11,center:t[0].geometry.location}),o.map.zoom=o.map.getZoom(),o.map.addListener("zoom_changed",e=>{o.zoomChangePolylines()})}):e()}),yodasws.on("page-loaded",()=>{"undefined"!=typeof $&&$&&$("main").on("click","li[data-stop-id]",e=>{var t=$(e.target).closest("li[data-stop-id]"),o=t.data("stop-id"),s=(t.parents("section[data-route-id]").data("route-id"),gtfs.stops[o].Marker.getVisible());!$(e.target).closest("section[data-route-id]").is(".active")&&t.is(".active")||(gtfs.hideStops(),$("li[data-stop-id].active").removeClass("active"),$("section[data-route-id].highlighted").removeClass("highlighted"),s||($("li[data-stop-id=\""+o+"\"]").addClass("active").parents("section[data-route-id]").addClass("highlighted"),gtfs.stops[o].Marker.setVisible(!0),gtfs.map.panTo(gtfs.stops[o].Marker.getPosition())))})})})();